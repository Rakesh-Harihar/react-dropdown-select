"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Select=void 0;var _react=_interopRequireWildcard(require("react")),_reactDom=_interopRequireDefault(require("react-dom")),_propTypes=_interopRequireDefault(require("prop-types")),_styled=_interopRequireDefault(require("@emotion/styled")),_ClickOutside=_interopRequireDefault(require("./components/ClickOutside")),_Content=_interopRequireDefault(require("./components/Content")),_Dropdown=_interopRequireDefault(require("./components/Dropdown")),_Loading=_interopRequireDefault(require("./components/Loading")),_Clear=_interopRequireDefault(require("./components/Clear")),_Separator=_interopRequireDefault(require("./components/Separator")),_DropdownHandle=_interopRequireDefault(require("./components/DropdownHandle")),_util=require("./util"),_constants=require("./constants");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}}return r.default=e,t&&t.set(e,r),r}function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _templateObject(){var e=_taggedTemplateLiteral(["\n  position: relative;\n  display: flex;\n  border: 1px solid #ccc;\n  width: 100%;\n  border-radius: 2px;\n  padding: 2px 5px;\n  flex-direction: row;\n  direction: ",";\n  align-items: center;\n  min-height: 36px;\n  ","\n  :hover,\n  :focus-within {\n    border-color: ",";\n  }\n  :focus,\n  :focus-within {\n    outline: 0;\n    box-shadow: 0 0 0 3px ",";\n  }\n"]);return _templateObject=function(){return e},e}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Select=function(e){function t(e){var r;return _classCallCheck(this,t),_defineProperty(_assertThisInitialized(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))),"onDropdownClose",function(){r.setState({cursor:null}),r.props.onDropdownClose()}),_defineProperty(_assertThisInitialized(r),"onScroll",function(){r.props.closeOnScroll&&r.dropDown("close"),r.updateSelectBounds()}),_defineProperty(_assertThisInitialized(r),"updateSelectBounds",function(){return r.select.current&&r.setState({selectBounds:r.select.current.getBoundingClientRect()})}),_defineProperty(_assertThisInitialized(r),"getSelectBounds",function(){return r.state.selectBounds}),_defineProperty(_assertThisInitialized(r),"dropDown",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"toggle",t=arguments.length>1?arguments[1]:void 0,o=t&&t.target||t&&t.srcElement;if(!(r.props.portal&&!r.props.closeOnScroll&&!r.props.closeOnSelect&&t&&o&&o.offsetParent&&o.offsetParent.classList.contains("react-dropdown-select-dropdown")))return r.props.keepOpen?r.setState({dropdown:!0}):"close"===e&&r.state.dropdown?(r.select.current.blur(),r.setState({dropdown:!1,search:r.props.clearOnBlur?"":r.state.search})):"open"!==e||r.state.dropdown?"toggle"===e&&(r.select.current.focus(),r.setState({dropdown:!r.state.dropdown})):r.setState({dropdown:!0})}),_defineProperty(_assertThisInitialized(r),"getSelectRef",function(){return r.select.current}),_defineProperty(_assertThisInitialized(r),"addItem",function(e){if(r.props.multi){if((0,_util.valueExistInSelected)((0,_util.getByPath)(e,r.props.valueField),r.state.values,r.props))return r.removeItem(null,e,!1);r.setState({values:[].concat(_toConsumableArray(r.state.values),[e])})}else r.setState({values:[e],dropdown:!1});return r.props.clearOnSelect&&r.setState({search:""}),!0}),_defineProperty(_assertThisInitialized(r),"removeItem",function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&o&&(e.preventDefault(),e.stopPropagation(),r.dropDown("close")),r.setState({values:r.state.values.filter(function(e){return(0,_util.getByPath)(e,r.props.valueField)!==(0,_util.getByPath)(t,r.props.valueField)})})}),_defineProperty(_assertThisInitialized(r),"setSearch",function(e){r.setState({cursor:null}),r.setState({search:e.target.value})}),_defineProperty(_assertThisInitialized(r),"getInputSize",function(){return r.state.search?r.state.search.length:r.state.values.length>0?r.props.addPlaceholder.length:r.props.placeholder.length}),_defineProperty(_assertThisInitialized(r),"toggleSelectAll",function(){return r.setState({values:0===r.state.values.length?r.selectAll():r.clearAll()})}),_defineProperty(_assertThisInitialized(r),"clearAll",function(){r.props.onClearAll(),r.setState({values:[]})}),_defineProperty(_assertThisInitialized(r),"selectAll",function(){return r.props.onSelectAll(),r.setState({values:r.props.options.filter(function(e){return!e.disabled})})}),_defineProperty(_assertThisInitialized(r),"isSelected",function(e){return!!r.state.values.find(function(t){return(0,_util.getByPath)(t,r.props.valueField)===(0,_util.getByPath)(e,r.props.valueField)})}),_defineProperty(_assertThisInitialized(r),"areAllSelected",function(){return r.state.values.length===r.props.options.filter(function(e){return!e.disabled}).length}),_defineProperty(_assertThisInitialized(r),"safeString",function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),_defineProperty(_assertThisInitialized(r),"sortBy",function(){var e=r.props,t=e.sortBy,o=e.options;return t?(o.sort(function(e,r){return(0,_util.getProp)(e,t)<(0,_util.getProp)(r,t)?-1:(0,_util.getProp)(e,t)>(0,_util.getProp)(r,t)?1:0}),o):o}),_defineProperty(_assertThisInitialized(r),"searchFn",function(e){var t=e.state,o=e.methods,n=new RegExp(o.safeString(t.search),"i");return o.sortBy().filter(function(e){return n.test((0,_util.getByPath)(e,r.props.searchBy)||(0,_util.getByPath)(e,r.props.valueField))})}),_defineProperty(_assertThisInitialized(r),"searchResults",function(){var e={state:r.state,props:r.props,methods:r.methods};return r.props.searchFn(e)||r.searchFn(e)}),_defineProperty(_assertThisInitialized(r),"activeCursorItem",function(e){return r.setState({activeCursorItem:e})}),_defineProperty(_assertThisInitialized(r),"handleKeyDown",function(e){var t=r.state.cursor;if("ArrowDown"===e.key&&null===t)return r.setState({cursor:0});if("ArrowUp"!==e.key&&"ArrowDown"!==e.key||e.preventDefault(),"Escape"===e.key&&r.dropDown("close"),"Enter"===e.key){var o=r.searchResults()[t];if(o&&!o.disabled){if(r.props.create&&(0,_util.valueExistInSelected)(r.state.search,r.state.values,r.props))return null;r.addItem(o)}}return"ArrowUp"===e.key&&t>0&&r.setState(function(e){return{cursor:e.cursor-1}}),"ArrowUp"===e.key&&0===t&&r.setState({cursor:r.searchResults().length}),"ArrowDown"===e.key&&r.setState(function(e){return{cursor:e.cursor+1}}),"ArrowDown"===e.key&&r.searchResults().length===t?r.setState({cursor:0}):void 0}),_defineProperty(_assertThisInitialized(r),"renderDropdown",function(){return r.props.portal?_reactDom.default.createPortal(_react.default.createElement(_Dropdown.default,{props:r.props,state:r.state,methods:r.methods}),r.dropdownRoot):_react.default.createElement(_Dropdown.default,{props:r.props,state:r.state,methods:r.methods})}),_defineProperty(_assertThisInitialized(r),"createNew",function(e){var t,o=(_defineProperty(t={},r.props.labelField,e),_defineProperty(t,r.props.valueField,e),t);r.addItem(o),r.props.onCreateNew(o),r.setState({search:""})}),r.state={dropdown:!1,values:e.values,search:"",selectBounds:{},cursor:null},r.methods={removeItem:r.removeItem,dropDown:r.dropDown,addItem:r.addItem,setSearch:r.setSearch,getInputSize:r.getInputSize,toggleSelectAll:r.toggleSelectAll,clearAll:r.clearAll,selectAll:r.selectAll,searchResults:r.searchResults,getSelectRef:r.getSelectRef,isSelected:r.isSelected,getSelectBounds:r.getSelectBounds,areAllSelected:r.areAllSelected,handleKeyDown:r.handleKeyDown,activeCursorItem:r.activeCursorItem,createNew:r.createNew,sortBy:r.sortBy,safeString:r.safeString},r.select=_react.default.createRef(),r.dropdownRoot="undefined"!=typeof document&&document.createElement("div"),r}return _inherits(t,_react.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.props.portal&&this.props.portal.appendChild(this.dropdownRoot),window.addEventListener("resize",(0,_util.debounce)(this.updateSelectBounds)),window.addEventListener("scroll",(0,_util.debounce)(this.onScroll)),this.dropDown("close"),this.select&&this.updateSelectBounds()}},{key:"componentDidUpdate",value:function(e,t){!(0,_util.isEqual)(e.values,this.props.values)&&(0,_util.isEqual)(e.values,t.values)&&(this.props.onChange(this.state.values),this.setState({values:this.props.values}),this.updateSelectBounds()),t.values!==this.state.values&&(this.props.onChange(this.state.values),this.updateSelectBounds()),t.search!==this.state.search&&this.updateSelectBounds(),t.values!==this.state.values&&this.props.closeOnSelect&&this.dropDown("close"),e.multi!==this.props.multi&&this.updateSelectBounds(),t.dropdown&&t.dropdown!==this.state.dropdown&&this.onDropdownClose(),t.dropdown||t.dropdown===this.state.dropdown||this.props.onDropdownOpen()}},{key:"componentWillUnmount",value:function(){this.props.portal&&this.props.portal.removeChild(this.dropdownRoot),window.removeEventListener("resize",(0,_util.debounce)(this.updateSelectBounds,this.props.debounceDelay)),window.removeEventListener("scroll",(0,_util.debounce)(this.onScroll,this.props.debounceDelay))}},{key:"render",value:function(){var e=this;return _react.default.createElement(_ClickOutside.default,{onClickOutside:function(t){return e.dropDown("close",t)}},_react.default.createElement(ReactDropdownSelect,{onKeyDown:this.handleKeyDown,onClick:function(t){return e.dropDown("toggle",t)},tabIndex:"0",direction:this.props.direction,style:this.props.style,ref:this.select,disabled:this.props.disabled,className:"".concat(_constants.LIB_NAME," ").concat(this.props.className),color:this.props.color},_react.default.createElement(_Content.default,{props:this.props,state:this.state,methods:this.methods}),this.props.name&&_react.default.createElement("input",{name:this.props.name,type:"hidden",value:this.props.values}),this.props.loading&&_react.default.createElement(_Loading.default,{props:this.props}),this.props.clearable&&_react.default.createElement(_Clear.default,{props:this.props,state:this.state,methods:this.methods}),this.props.separator&&_react.default.createElement(_Separator.default,{props:this.props,state:this.state,methods:this.methods}),this.props.dropdownHandle&&_react.default.createElement(_DropdownHandle.default,{onClick:function(){return e.select.current.focus()},props:this.props,state:this.state,methods:this.methods}),this.state.dropdown&&this.renderDropdown()))}}]),t}();exports.Select=Select,_defineProperty(Select,"propTypes",{onChange:_propTypes.default.func.isRequired,onDropdownClose:_propTypes.default.func,onDropdownOpen:_propTypes.default.func,onClearAll:_propTypes.default.func,onSelectAll:_propTypes.default.func,values:_propTypes.default.array,options:_propTypes.default.array.isRequired,keepOpen:_propTypes.default.bool,dropdownGap:_propTypes.default.number,multi:_propTypes.default.bool,placeholder:_propTypes.default.string,addPlaceholder:_propTypes.default.string,disabled:_propTypes.default.bool,className:_propTypes.default.string,loading:_propTypes.default.bool,clearable:_propTypes.default.bool,searchable:_propTypes.default.bool,separator:_propTypes.default.bool,dropdownHandle:_propTypes.default.bool,searchBy:_propTypes.default.string,sortBy:_propTypes.default.string,closeOnScroll:_propTypes.default.bool,openOnTop:_propTypes.default.bool,style:_propTypes.default.object,contentRenderer:_propTypes.default.func,dropdownRenderer:_propTypes.default.func,itemRenderer:_propTypes.default.func,noDataRenderer:_propTypes.default.func,optionRenderer:_propTypes.default.func,inputRenderer:_propTypes.default.func,loadingRenderer:_propTypes.default.func,clearRenderer:_propTypes.default.func,separatorRenderer:_propTypes.default.func,dropdownHandleRenderer:_propTypes.default.func,direction:_propTypes.default.string}),Select.defaultProps={addPlaceholder:"",placeholder:"Select...",values:[],options:[],multi:!1,disabled:!1,searchBy:"label",sortBy:null,clearable:!1,searchable:!0,dropdownHandle:!0,separator:!1,keepOpen:void 0,noDataLabel:"No data",createNewLabel:"add {search}",disabledLabel:"disabled",dropdownGap:5,closeOnScroll:!1,debounceDelay:0,labelField:"label",valueField:"value",color:"#0074D9",keepSelectedInList:!0,closeOnSelect:!1,clearOnBlur:!0,clearOnSelect:!0,dropdownPosition:"bottom",dropdownHeight:"300px",autoFocus:!1,portal:null,create:!1,direction:"ltr",name:null,onChange:function(){},onDropdownOpen:function(){},onDropdownClose:function(){},onClearAll:function(){},onSelectAll:function(){},onCreateNew:function(){},searchFn:function(){}};var ReactDropdownSelect=_styled.default.div(_templateObject(),function(e){return e.direction},function(e){return e.disabled?"cursor: not-allowed;pointer-events: none;opacity: 0.3;":"pointer-events: all;"},function(e){return e.color},function(e){var t=e.color;return(0,_util.hexToRGBA)(t,.2)}),_default=Select;exports.default=_default;
